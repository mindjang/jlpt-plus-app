import * as fs from 'fs'
import * as path from 'path'
import { KanjiAliveEntry } from '../data/types'

const RAPIDAPI_KEY: string = process.env.RAPIDAPI_KEY ?? ''
if (!RAPIDAPI_KEY) {
  throw new Error('RAPIDAPI_KEY 환경변수가 설정되지 않았습니다.')
}

// N1 한자 목록과 한글 뜻 매핑 (사용자 제공)
const N1_KOREAN_MEANINGS: Record<string, string> = {
  '結': '넥타이',
  '張': '길게 하다',
  '保': '보호하다',
  '撃': '이기다',
  '証': '증거',
  '士': '신사',
  '第': '아니요.',
  '郎': '아들',
  '応': '적용하다',
  '護': '보호하다',
  '離': '분리하다',
  '藤': '등나무',
  '態': '태도',
  '検': '시험',
  '井': '잘',
  '我': '에고',
  '視': '검사',
  '隊': '연대',
  '義': '의로움',
  '統': '전반적으로',
  '案': '계획',
  '器': '기구',
  '僕': '나',
  '影': '그림자',
  '独': '단일',
  '派': '파벌',
  '氏': '성씨',
  '監': '감독하다',
  '攻': '공격성',
  '宮': '신사',
  '佐': '조수',
  '姿': '모양',
  '傷': '상처',
  '素': '초등학교의',
  '救': '구원',
  '価': '가치',
  '松': '소나무',
  '壊': '철거',
  '弁': '밸브',
  '援': '교사하다',
  '貴': '귀중한',
  '崎': '곶',
  '基': '기초',
  '故': '우연',
  '刑': '처벌하다',
  '嫌': '싫어하다',
  '密': '비밀',
  '裁': '재단사',
  '謝': '사과하다',
  '提': '제안하다',
  '衛': '방어',
  '秘': '비밀',
  '雄': '남성적인',
  '隠': '감추다',
  '異': '드문',
  '銃': '총',
  '興': '즐기다',
  '条': '기사',
  '修': '훈육',
  '振': '흔들다',
  '審': '청문회',
  '脱': '옷을 벗다',
  '司': '감독',
  '沢': '늪',
  '魔': '마녀',
  '従': '동반하다',
  '激': '폭력적인',
  '敵': '적',
  '弾': '총알',
  '響': '메아리',
  '頑': '고집 센',
  '闘': '싸우다',
  '撮': '스냅샷',
  '授': '전하다',
  '遺': '유증하다',
  '策': '계획',
  '拠': '발판',
  '功': '성취',
  '吉': '행운을 빌어요',
  '奈': '나라',
  '驚': '궁금하다',
  '整': '조직하다',
  '製': '에서 만든...',
  '織': '짜다',
  '訴': '비난',
  '街': '대로',
  '緊': '시제',
  '惑': '현혹하다',
  '誘': '유혹하다',
  '聖': '신성한',
  '悟': '계몽',
  '評': '평가하다',
  '黙': '침묵',
  '率': '비율',
  '泣': '울다',
  '督': '코치',
  '奪': '강탈하다',
  '志': '의도',
  '健': '건강한',
  '挙': '올리다',
  '射': '쏘다',
  '携': '휴대용',
  '避': '피하다',
  '宙': '공중',
  '厳': '엄격한',
  '博': '박사',
  '幕': '커튼',
  '施': '주다',
  '企': '착수하다',
  '逮': '체포하다',
  '訳': '번역하다',
  '江': '개울',
  '抗': '직면하다',
  '展': '펼치다',
  '聴': '듣다',
  '級': '수업',
  '尾': '꼬리',
  '標': '이정표',
  '奴': '사람',
  '継': '상속하다',
  '剣': '사브르',
  '障': '방해하다',
  '皇': '황제',
  '票': '투표용지',
  '騒': '활기찬',
  '善': '덕이 있는',
  '盛': '붐',
  '描': '스케치',
  '麻': '대마',
  '筋': '근육',
  '襲': '공격',
  '系': '계보',
  '恵': '호의',
  '鈴': '작은 종',
  '樹': '목재',
  '操': '조작',
  '壁': '벽',
  '鮮': '신선한',
  '創': '창세기',
  '矢': '다트',
  '紀': '연대기',
  '染': '염료',
  '邪': '사악한',
  '誕': '탄생',
  '輩': '동지',
  '歓': '기쁨',
  '踏': '단계',
  '瞬': '윙크',
  '症': '증상',
  '挑': '도전',
  '竜': '용',
  '浜': '해안',
  '迫': '촉구하다',
  '環': '반지',
  '滅': '파괴하다',
  '儀': '의식',
  '養': '조성하다',
  '源': '출처',
  '納': '합의',
  '端': '가장자리',
  '艦': '전함',
  '渉': '포드',
  '妙': '정교한',
  '霊': '영혼들',
  '契': '서약',
  '請': '간청하다',
  '怪': '의심스러운',
  '為': '하다',
  '殴': '공격',
  '懸': '정지 상태',
  '推': '추측',
  '診': '검진',
  '脅': '위협하다',
  '模': '모방',
  '遣': '파견하다',
  '及': '연락하다',
  '討': '징계하다',
  '握': '그립',
  '隣': '인접한',
  '康': '완화하다',
  '載': '타다',
  '憶': '회상',
  '至': '클라이맥스',
  '房': '술장식',
  '執': '끈질긴',
  '秀': '뛰어나다',
  '慢': '조롱',
  '華': '화려함',
  '扱': '핸들',
  '徳': '자비심',
  '択': '선택하다',
  '衝': '충돌하다',
  '衆': '대중',
  '偽': '거짓말',
  '幹': '나무 줄기',
  '鬼': '유령',
  '崩': '부스러기',
  '尽': '배기',
  '悔': '회개하다',
  '津': '피난처',
  '侵': '침해하다',
  '宣': '선언하다',
  '稼': '수익',
  '葬': '매장',
  '奇': '이상한',
  '株': '주식',
  '冗': '여분의',
  '宗': '종교',
  '看': '감시하다',
  '穴': '구멍',
  '就': '관하여',
  '節': '노드',
  '締': '조이다',
  '詳': '상세한',
  '輝': '광휘',
  '脚': '미끄럼 방지 장치',
  '拒': '격퇴하다',
  '慮': '신중함',
  '邦': '모국',
  '仮': '가짜',
  '裂': '쪼개다',
  '駄': '번거로운',
  '帝': '주권자',
  '繰': '구불구불한',
  '益': '혜택',
  '耐': '-증명',
  '獲': '잡다',
  '拍': '박수',
  '姫': '공주',
  '魅': '매혹',
  '催': '후원자',
  '駆': '운전하다',
  '誠': '성실',
  '勘': '직관',
  '酔': '취한',
  '郷': '고향',
  '恩': '우아함',
  '陣': '캠프',
  '罰': '페널티',
  '索': '코드',
  '裕': '풍부한',
  '慎': '겸손',
  '桜': '체리',
  '揺': '그네',
  '致': '하다',
  '属': '속하다',
  '償': '보상',
  '己': '자기',
  '徹': '관통하다',
  '露': '이슬',
  '剤': '용량',
  '抑': '억압하다',
  '焦': '문자',
  '陛': '전하',
  '獄': '감옥',
  '屈': '수확량',
  '犠': '희생',
  '暇': '여가 시간',
  '融': '용해하다',
  '免': '변명',
  '揮': '휘두르다',
  '忠': '충성심',
  '瀬': '급류',
  '哲': '철학',
  '柄': '디자인',
  '僚': '동료',
  '威': '위협하다',
  '徴': '징후',
  '誇': '자랑하다',
  '飾': '장식하다',
  '炎': '염증',
  '倉': '창고',
  '牲': '동물 희생',
  '奏': '음악 재생',
  '廃': '폐지하다',
  '妊': '임신',
  '維': '섬유',
  '砲': '대포',
  '塚': '작은 언덕',
  '核': '핵',
  '距': '장거리',
  '亜': '아시아',
  '釈': '설명',
  '縁': '친화성',
  '句': '구절',
  '譲': '연기하다',
  '批': '비판',
  '牧': '번식하다',
  '潜': '잠수시키다',
  '撤': '제거하다',
  '献': '제공',
  '称': '호칭',
  '琴': '하프',
  '躍': '도약',
  '削': '비행기',
  '魂': '영혼',
  '酸': '산',
  '析': '자르다',
  '敷': '퍼지다',
  '臨': '보라',
  '仙': '은둔자',
  '災': '재해',
  '却': '대신에',
  '巡': '순찰',
  '縮': '줄어들다',
  '摘': '꼬집다',
  '唯': '단독으로',
  '雷': '천둥',
  '沙': '모래',
  '陰': '그늘',
  '趣': '의미',
  '拡': '넓히다',
  '銭': '동전',
  '妖': '매력적인',
  '透': '투명한',
  '誓': '맹세',
  '盟': '동맹',
  '顧': '뒤돌아보다',
  '腐': '회전하다',
  '豪': '압도적인',
  '寂': '외로움',
  '浦': '만',
  '棄': '포기하다',
  '鎖': '사슬',
  '抵': '저항하다',
  '吐': '침',
  '閣': '탑',
  '豆': '콩',
  '既': '이전에',
  '孤': '고아',
  '冒': '위험',
  '典': '코드',
  '喪': '그리워하다',
  '伏': '엎드린',
  '芝': '잔디',
  '舎': '오두막',
  '遭': '조우',
  '還': '돌려보내다',
  '盤': '쟁반',
  '肝': '간',
  '詩': '시',
  '戒': '계명',
  '誉': '평판',
  '滑': '미끄러운',
  '鏡': '거울',
  '脈': '정맥',
  '梨': '배나무',
  '那': '뭐?',
  '杉': '삼나무',
  '賀': '축하합니다',
  '丁': '거리',
  '控': '철회하다',
  '伴': '배우자',
  '充': '할당하다',
  '賃': '요금',
  '排': '거부하다',
  '飼': '길들이다',
  '臭': '악취가 나는',
  '須': '~해야 한다',
  '鹿': '사슴',
  '微': '섬세한',
  '墓': '무덤',
  '沖': '열린 바다',
  '漏': '누출',
  '鍵': '열쇠',
  '甲': '갑옷',
  '奮': '휘젓다',
  '忍': '견디다',
  '尋': '문의하다',
  '謀': '공모하다',
  '桃': '복숭아',
  '勧': '설득하다',
  '即': '즉각적인',
  '釣': '낚시',
  '刀': '검',
  '揚': '올리다',
  '堅': '엄격한',
  '幻': '환영',
  '郡': '군',
  '菊': '국화',
  '滞': '정체되다',
  '貫': '꿰뚫다',
  '愚': '어리석은',
  '拐': '납치',
  '遂': '완벽한',
  '胞': '태반',
  '騎': '승마의',
  '嫁': '시집가다 / 장가가다',
  '紫': '보라색',
  '嬢': '여학생',
  '斎': '정화',
  '懐': '감정',
  '範': '패턴',
  '弥': '더욱더',
  '憲': '헌법',
  '添': '합병된',
  '亀': '거북이',
  '暑': '후덥지근한',
  '惨': '비참한',
  '娠': '임신한',
  '獣': '동물',
  '陥': '붕괴',
  '狂': '광인',
  '潮': '조수',
  '紛': '산만하게 하다',
  '縄': '짚으로 만든 밧줄',
  '絞': '교살하다',
  '随': '따르다',
  '畑': '농장',
  '班': '팀',
  '糖': '설탕',
  '雰': '대기',
  '斉': '조정된',
  '幽': '격리하다',
  '俳': '하이쿠',
  '紋': '가문 문장',
  '覆': '전복하다',
  '狩': '사냥하다',
  '虎': '호랑이',
  '託': '위탁하다',
  '廷': '법원',
  '狭': '비좁은',
  '穂': '귀',
  '諦': '진실',
  '賊': '도둑',
  '翼': '날개',
  '覧': '정독',
  '酷': '잔인한',
  '敏': '영리함',
  '拘': '체포',
  '慰': '위안',
  '項': '단락',
  '縦': '수직의',
  '渋': '수렴제',
  '眼': '안구',
  '孝': '효도',
  '妃': '여왕',
  '旗': '국기',
  '虐': '폭정을 일삼다',
  '貢': '공물',
  '繁': '무성한',
  '阻': '좌절시키다',
  '麗': '사랑스러운',
  '稿': '초안',
  '匠': '장인',
  '玄': '신비로운',
  '熊': '곰',
  '璧': '구체',
  '堀': '도랑',
  '懲': '형벌의',
  '巣': '둥지',
  '熟': '부드러운',
  '稲': '벼',
  '邸': '거주지',
  '暖': '따뜻함',
  '烈': '열렬한',
  '呪': '철자',
  '遇': '만나다',
  '鑑': '견본',
  '購': '구독',
  '呂': '척추',
  '殊': '특히',
  '彩': '색칠하기',
  '賭': '도박',
  '薦': '추천하다',
  '隔': '고립시키다',
  '唱': '성가',
  '序': '서문',
  '尉': '군 장교',
  '俊': '현명한',
  '柳': '버드나무',
  '凶': '악당',
  '惜': '연민',
  '恨': '후회',
  '倫': '윤리학',
  '泰': '평화로운',
  '仰': '위로 향한',
  '洞': '덴',
  '漫': '만화',
  '胆': '담낭',
  '扉': '현관문',
  '緩': '느슨하게 하다',
  '掲': '게시하다',
  '鋼': '강철',
  '裸': '벌거벗은',
  '噴': '분출하다',
  '芽': '싹',
  '訟': '소송하다',
  '砕': '부수다',
  '叔': '삼촌',
  '茂': '우거진',
  '帳': '노트북',
  '猛': '사나운',
  '欺': '사기',
  '没': '익사하다',
  '網': '그물치기',
  '励': '격려하다',
  '斗': '북두칠성',
  '昭': '빛나는',
  '偵': '스파이',
  '履': '수행하다',
  '豚': '돼지고기',
  '肺': '폐',
  '沿': '나란히 달리다',
  '褒': '칭찬',
  '兼': '동시에',
  '謎': '수수께끼',
  '僧': '승려',
  '潔': '흠없는',
  '桑': '뽕나무',
  '雅': '우아한',
  '飽': '만족한',
  '縛': '트러스',
  '拳': '주먹',
  '跳': '홉',
  '伯': '주요한',
  '晶': '반짝이다',
  '妨': '방해하다',
  '辱': '당황하게 하다',
  '刃': '칼',
  '膨': '부기',
  '嵐': '폭풍',
  '沼': '습지',
  '哀': '한심한',
  '浄': '깨끗한',
  '滝': '폭포',
  '債': '채권',
  '笛': '플루트',
  '穏': '차분한',
  '虚': '무효',
  '后': '황후',
  '憩': '휴식',
  '煮': '끓이다',
  '拓': '개간하다',
  '摩': '짜증나게 하다',
  '睡': '졸린',
  '癒': '치유',
  '朗': '선율적인',
  '菌': '세균',
  '盾': '방패',
  '披': '노출하다',
  '浪': '방랑하는',
  '詐': '거짓말',
  '劣': '열등감',
  '霧': '안개',
  '鶴': '크레인',
  '峰': '정상회담',
  '慈': '자비',
  '蹴': '발로 차다',
  '喚': '소리치다',
  '浸': '몰두한',
  '酬': '갚다',
  '促': '자극하다',
  '寛': '관대한',
  '妥': '부드러운',
  '圏': '구체',
  '卓': '저명한',
  '冠': '왕관',
  '舌': '혀',
  '羅': '거즈',
  '綱': '홋줄',
  '克': '극복하다',
  '梅': '자두',
  '潰': '크러시',
  '縫': '꿰매다',
  '奉': '준수',
  '簿': '등록하다',
  '悠': '영속성',
  '撲': '때리다',
  '隆': '혹',
  '痕': '표시',
  '棚': '선반',
  '枠': '프레임',
  '偏': '부분적인',
  '猿': '원숭이',
  '慌': '당황한',
  '軌': '고정된 상태',
  '鍛': '위조하다',
  '鎮': '진정시키다',
  '覇': '패권',
  '架': '세우다',
  '挨': '접근하다',
  '併': '가입하다',
  '征': '정복하다',
  '蛇': '뱀',
  '牙': '엄니',
  '佳': '훌륭한',
  '寧': '오히려',
  '尚': '존경',
  '塁': '기지들',
  '丘': '언덕',
  '駒': '조랑말',
  '棟': '마룻대',
  '貞': '똑바로 서 있는',
  '錠': '잠그다',
  '鐘': '벨',
  '敢': '대담한',
  '薫': '향기를 발산하다',
  '囚': '포착된',
  '飢': '배고픈',
  '繊': '날씬한',
  '鶏': '닭',
  '需': '수요',
  '概': '개요',
  '稚': '미성숙한',
  '荘': '빌라',
  '漠': '모호한',
  '慶': '환희',
  '殖': '증강하다',
  '尿': '소변',
  '廊': '복도',
  '粋': '세련된',
  '往': '여정',
  '乏': '빈곤',
  '鍋': '냄비',
  '賄': '뇌물',
  '把': '이해하다',
  '鼓': '드럼',
  '嘆': '한숨',
  '眺': '응시하다',
  '是': '그냥 그렇게',
  '寸': '측정',
  '措': '제외하다',
  '墜': '충돌',
  '肥': '비료',
  '羊': '양',
  '炉': '노벽',
  '粧': '화장품',
  '丹': '녹슨 색의',
  '曹': '사무실',
  '彫': '조각하다',
  '秩': '규칙성',
  '旦': '새벽',
  '磁': '자석',
  '漂': '표류',
  '腸': '장',
  '乙': '후자',
  '匂': '향기로운',
  '汁': '수프',
  '腫': '종양',
  '卑': '천하게',
  '較': '대조',
  '祥': '길조의',
  '赦': '사면',
  '粘': '끈적끈적한',
  '奨': '권하다',
  '隷': '노예',
  '垂': '처지다',
  '拶': '임박하다',
  '寮': '기숙사',
  '剰': '잉여',
  '癖': '매너리즘',
  '恒': '항상성',
  '涯': '수평선',
  '厄': '불운한',
  '侮': '경멸',
  '培': '재배하다',
  '曽': '이전에',
  '壇': '연단',
  '芳': '향수',
  '垣': '울타리',
  '銘': '명각',
  '巧': '능숙한',
  '宴': '연회',
  '剛': '튼튼한',
  '徐': '점진적으로',
  '怠': '무시하다',
  '弓': '활',
  '蓄': '모으다',
  '漬': '피클링',
  '穫': '수확',
  '爪': '발톱',
  '泡': '거품',
  '疫': '전염병',
  '凡': '평범한',
  '陳': '전시하다',
  '搭': '보드',
  '頻': '반복적으로',
  '糧': '규정',
  '礎': '초석',
  '啓': '공개하다',
  '謙': '겸손한',
  '扶': '지원',
  '塊': '흙덩이',
  '翻': '뒤집다',
  '彰': '특허',
  '摂': '대리의',
  '恭': '존중',
  '疎': '소외시키다',
  '苗': '묘목',
  '祉': '복지',
  '殻': '껍질',
  '紳': '폐하',
  '膜': '막',
  '径': '직경',
  '虜': '포로',
  '珠': '진주',
  '傘': '우산',
  '嫉': '질투하는',
  '唐': '당',
  '壮': '견고한',
  '侍': '웨이터',
  '暦': '달력',
  '勲': '공로 있는 행위',
  '軸': '축',
  '淡': '얇은',
  '粗': '거친',
  '矛': '미늘창',
  '妬': '질투하는',
  '瞳': '동공',
  '憧': '갈망하다',
  '汽': '증기',
  '閥': '클리크',
  '岳': '점',
  '衰': '거절하다',
  '痴': '멍청한',
  '斜': '대각선',
  '諾': '동의',
  '逸': '벗어나다',
  '拷': '고문',
  '朱': '주홍색',
  '肢': '팔다리',
  '餌': '음식',
  '疾': '빠르게',
  '俗': '저속한',
  '舗': '상점',
  '蛍': '반딧불이',
  '扇': '팬',
  '澄': '명료함',
  '栽': '플랜테이션',
  '搬': '컨베이어',
  '遮': '가로채다',
  '唇': '입술',
  '凝': '응고하다',
  '陪': '경의',
  '葛': '마',
  '妄': '망상',
  '愉': '즐거움',
  '塾': '학원',
  '括': '고정하다',
  '拭': '닦다',
  '傑': '위대함',
  '憂': '우울함',
  '旨': '맛있는',
  '腎': '신장',
  '擁': '포옹',
  '椎': '친퀘핀',
  '醜': '못생긴',
  '塞': '닫다',
  '亭': '파빌리온',
  '如': '닮음',
  '粛': '엄숙한',
  '麺': '면',
  '窮': '곤궁한',
  '猟': '사냥',
  '傍': '방관자',
  '髄': '골수',
  '溝': '배수로',
  '緯': '수평의',
  '隙': '틈',
  '胎': '자궁',
  '錯': '혼란스러운',
  '爵': '남작',
  '懇': '사교적인',
  '艇': '노 젓는 보트',
  '刈': '수확하다',
  '岐': '갈라지다',
  '暫': '임시로',
  '悼': '애도',
  '弦': '활시위',
  '昆': '후손',
  '墨': '검은 잉크',
  '錬': '템퍼링',
  '潤': '젖은',
  '捉': '잡다',
  '抽': '뽑다',
  '鯨': '고래',
  '旬': '데카메론',
  '嗅': '냄새',
  '渇': '갈증',
  '湧': '끓이다',
  '帆': '항해하다',
  '賠': '보상',
  '肪': '비만의',
  '挿': '삽입',
  '掌': '조작하다',
  '枕': '베개',
  '擦': '강판',
  '暁': '새벽',
  '枢': '힌지',
  '崇': '숭배하다',
  '陵': '영묘',
  '鉛': '리드',
  '貼': '막대기',
  '蜂': '벌',
  '酢': '식초',
  '窒': '막다',
  '据': '설정',
  '准': '준-',
  '棋': '체스 말',
  '旋': '회전',
  '股': '허벅지',
  '渦': '소용돌이',
  '椅': '의자',
  '釜': '주전자',
  '錦': '금직',
  '炊': '요리하다',
  '陶': '도자기',
  '踪': '유해',
  '践': '밟다',
  '顕': '나타나다',
  '盲': '맹인',
  '庶': '평민',
  '轄': '제어',
  '騰': '껑충 뛰기',
  '虹': '무지개',
  '宰': '감독하다',
  '柿': '감',
  '碁': '가다',
  '猶': '게다가',
  '堕': '퇴화하다',
  '冥': '어두운',
  '臆': '소심함',
  '又': '또는 다시',
  '溺': '익사하다',
  '槽': '부가가치세',
  '鉢': '그릇',
  '絹': '비단',
  '匿': '숨다',
  '婿': '신랑',
  '鎌': '낫',
  '窟': '동굴',
  '餅': '모찌 떡',
  '痩': '마르다',
  '剖': '나누다',
  '呉': '주다',
  '戚': '슬퍼하다',
  '婆': '노인 여성',
  '孔': '충치',
  '梗': '대부분',
  '睦': '친밀한',
  '窃': '은밀함',
  '戯': '장난치며 놀다',
  '宜': '감사합니다.',
  '堪': '견디다',
  '赴': '진행하다',
  '眉': '눈썹',
  '抹': '문지르다',
  '忌': '애도',
  '迅': '신속한',
  '喝': '쉰 목소리의',
  '蛮': '야만인',
  '喉': '목',
  '拙': '서투른',
  '瘍': '부기',
  '悦': '황홀감',
  '丼': '그릇',
  '朽': '부패',
  '諭': '꾸짖다',
  '逝': '출발했다',
  '唆': '유혹하다',
  '挫': '크러쉬',
  '棺': '관',
  '袖': '소매',
  '埼': '망토',
  '汰': '세탁',
  '胴': '트렁크',
  '酵': '발효',
  '該': '위에 언급된',
  '搾': '짜다',
  '娯': '레크리에이션',
  '欄': '열',
  '郭': '인클로저',
  '盆': '대야',
  '謹': '신중한',
  '詠': '암송',
  '蚊': '모기',
  '穀': '시리얼',
  '蜜': '꿀',
  '帥': '사령관',
  '羨': '부러운',
  '宛': '주소',
  '藍': '남색',
  '稽': '생각하다',
  '礁': '암초',
  '朴': '원유',
  '伐': '떨어졌다',
  '洪': '홍수',
  '詮': '토론',
  '呈': '디스플레이',
  '訂': '수정하다',
  '堤': '제방',
  '循': '순차적인',
  '淑': '우아한',
  '骸': '뼈',
  '媒': '중재자',
  '栓': '플러그',
  '餓': '굶주리다',
  '壌': '많이',
  '崖': '절벽',
  '箸': '젓가락',
  '慕': '그리워하는',
  '篤': '열렬한',
  '蓋': '덮다',
  '膳': '작은 낮은 테이블',
  '藻': '해초',
  '凄': '불가사의한',
  '矯': '정정하다',
  '廉': '흥정',
  '弊': '남용',
  '漆': '래커',
  '姻': '결혼',
  '尼': '수녀',
  '弔': '애도',
  '濁': '유성의',
  '擬': '흉내내다',
  '酪': '유제품',
  '卸': '도매',
  '渓': '산골짜기 계곡',
  '謡': '노래',
  '勃': '급작스러움',
  '滋': '영양가 있는',
  '煩': '불안',
  '憤': '흥분한',
  '幣': '현금',
  '拉': '라틴어',
  '禅': '젠',
  '肖': '유사성',
  '塀': '울타리',
  '賓': '귀빈',
  '瑠': '청금석',
  '俵': '가방',
  '脊': '위상',
  '閲': '검토',
  '譜': '악보',
  '硫': '황',
  '痢': '설사',
  '紺': '짙은 파란색',
  '雌': '여성의',
  '爽': '상쾌한',
  '醒': '깨어있는',
  '潟': '석호',
  '茨': '가시덤불',
  '串': '침',
  '衡': '평형',
  '茎': '스토킹',
  '賂': '뇌물',
  '乞': '구걸하다',
  '戴': '~로 왕관을 씌우다',
  '殉': '순교',
  '碑': '묘비',
  '坪': '두 장의 다다미 공간',
  '峡': '협곡',
  '岬': '곶',
  '侶': '동반자',
  '籠': '바구니',
  '宵': '새벽 시간',
  '刹': '사원',
  '怨': '원한',
  '芋': '감자',
  '繕': '짜깁기',
  '屯': '막사',
  '甚': '엄청나게',
  '瓦': '타일',
  '醸': '양조하다',
  '吟': '운문으로 만들다',
  '藩': '씨족',
  '僅': '조금',
  '酎': '사케',
  '薪': '연료',
  '斑': '장소',
  '遍': '도처에',
  '奔': '달리다',
  '尺': '샤쿠',
  '侯': '후작',
  '嚇': '위협적인',
  '腺': '샘',
  '罵': '남용',
  '泌': '스며나오다',
  '峠': '산봉우리',
  '韻': '운율',
  '傲': '자랑스러워하다',
  '媛': '아름다운 여자',
  '唾': '침',
  '楼': '감시탑',
  '襟': '칼라',
  '巾': '수건',
  '璃': '유리 같은',
  '臼': '박격포',
  '逐': '추구하다',
  '貌': '형태',
  '蔽': '덮다',
  '坑': '구덩이',
  '賜': '부여하다',
  '桁': '빔',
  '慨': '진실',
  '舷': '건월',
  '蔑': '무시하다',
  '昧': '어두운',
  '耗': '감소',
  '芯': '심지',
  '嗣': '상속인',
  '柵': '목책',
  '硝': '질산염',
  '弄': '함께 놀다',
  '享': '즐기다',
  '繭': '고치',
  '煎': '굽다',
  '箇': '편 기사',
  '勾': '구부러지다',
  '勅': '제국 명령',
  '憾': '후회',
  '倣': '모방하다',
  '鬱': '우울',
  '唄': '노래',
  '淫': '음란함',
  '紡': '회전',
  '愁': '고통',
  '朕': '위엄 있는 복수',
  '糾': '비틀다',
  '遷': '전환',
  '禍': '재난',
  '旺': '번영하는',
  '栃': '마로니에',
  '箋': '종이',
  '吏': '장교',
  '桟': '비계',
  '玩': '놀이',
  '遜': '겸손한',
  '酌': '바텐딩',
  '霜': '서리',
  '哺': '간호사',
  '瞭': '맑은',
  '叙': '수여하다',
  '舶': '라이너',
  '畿': '수도',
  '謁': '청중',
  '累': '축적하다',
  '采': '주사위',
  '冶': '녹는',
  '曖': '어두운',
  '惧': '두려움',
  '綻': '임대되다',
  '裾': '소매',
  '某': '아무개',
  '阜': '언덕',
  '頓': '갑자기',
  '俸': '봉급',
  '喩': '은유',
  '惰': '게으른',
  '閑': '여가',
  '肘': '팔꿈치',
  '窯': '가마',
  '苛': '고문',
  '寡': '과부',
  '捻': '회전',
  '褐': '갈색',
  '遡': '상류로 가다',
  '堆': '높게 쌓인',
  '顎': '턱',
  '畔': '벼 능선',
  '諮': '상담하다',
  '璽': '황제의 인장',
  '翁': '존경할 만한 노인',
  '儒': '유교의',
  '艶': '광택 있는',
  '斥': '거부하다',
  '貪': '탐내다',
  '墳': '무덤',
  '萎': '시들다',
  '附': '부착된',
  '罷': '그만두다',
  '劾': '비난',
  '畏': '두려움',
  '鋳': '캐스팅',
  '捗': '진전을 이루다',
  '詔': '칙령',
  '辣': '톡 쏘는',
  '租': '관세',
  '沃': '다산성',
  '升': '측정 상자',
  '摯': '선물',
  '厘': '린',
  '咽': '목',
  '毀': '깨다',
  '庸': '흔한',
  '緻': '고운',
  '嫡': '적법한 아내',
  '訃': '부고',
  '伎': '증서',
  '詣': '사원을 방문하다',
  '麓': '산기슭',
  '痘': '폭스',
  '嘲': '조롱',
  '倹': '검소한',
  '款': '호의',
  '汎': '팬',
  '弐': 'II',
  '弧': '호弧',
  '嘱': '위임하다',
  '賦': '부과하다',
  '迭': '이전',
  '羞': '부끄러워하다',
  '凹': '오목한',
  '濫': '과도한',
  '氾': '퍼지다',
  '凸': '볼록한',
  '衷': '가장 깊은',
  '慄': '두려움',
  '遵': '준수하다',
  '蚕': '누에',
  '剝': '벗어나다',
  '彙': '같은 종류',
  '斤': '도끼',
  '壱': '일자',
  '丙': '삼등급',
  '但': '그러나',
  '錮': '감금',
  '謄': '등사기',
  '墾': '획기적인',
  '逓': '중계',
  '抄': '추출하다',
  '且': '게다가',
  '塑': '모델',
  '虞': '두려움',
  '恣': '이기적인',
  '漸': '꾸준히',
  '畝': '고랑',
  '塡': '채우기',
  '楷': '사각 문자 스타일',
  '頒': '배포하다',
  '頰': '뺨',
  '憬': '갈망하다',
  '諧': '조화',
  '𠮟': '꾸짖다'
}

const N1_KANJI_LIST = Object.keys(N1_KOREAN_MEANINGS)

async function fetchKanjiData(kanji: string, retryCount = 0): Promise<any | null> {
  const url = `https://kanjialive-api.p.rapidapi.com/api/public/kanji/${encodeURIComponent(kanji)}`
  const MAX_RETRIES = 3
  
  try {
    const response = await fetch(url, {
      headers: {
        'X-RapidAPI-Key': RAPIDAPI_KEY,
        'X-RapidAPI-Host': 'kanjialive-api.p.rapidapi.com',
      } satisfies HeadersInit,
    })
    
    if (!response.ok) {
      if (response.status === 404) {
        console.log(`  ⚠ ${kanji}: 데이터를 찾을 수 없습니다`)
        return null
      }
      if (response.status === 429) {
        if (retryCount < MAX_RETRIES) {
          const waitTime = (retryCount + 1) * 5000 // 5초, 10초, 15초
          console.log(`  ⚠ ${kanji}: API 호출 제한 (429), ${waitTime/1000}초 대기 후 재시도... (${retryCount + 1}/${MAX_RETRIES})`)
          await new Promise(resolve => setTimeout(resolve, waitTime))
          return fetchKanjiData(kanji, retryCount + 1)
        }
        console.log(`  ✗ ${kanji}: API 호출 제한 (429), 재시도 횟수 초과`)
        return null
      }
      console.error(`  ✗ ${kanji}: API 호출 실패 (${response.status})`)
      return null
    }
    
    const data = await response.json()
    return data
  } catch (error) {
    if (retryCount < MAX_RETRIES) {
      const waitTime = (retryCount + 1) * 2000
      console.log(`  ⚠ ${kanji}: 오류 발생, ${waitTime/1000}초 대기 후 재시도... (${retryCount + 1}/${MAX_RETRIES})`)
      await new Promise(resolve => setTimeout(resolve, waitTime))
      return fetchKanjiData(kanji, retryCount + 1)
    }
    console.error(`  ✗ ${kanji}: 오류 발생 (재시도 횟수 초과)`, error)
    return null
  }
}

function filterKanjiAliveEntry(data: any, koreanMeaning?: string): KanjiAliveEntry {
  // 인터페이스에 정의된 필드만 추출
  const entry: KanjiAliveEntry = {
    _id: data._id,
    _rev: data._rev,
    ka_utf: data.ka_utf,
    kanji: data.kanji,
    radical: data.radical,
  }
  
  // kanji.meaning.korean 필드 추가
  if (data.kanji && data.kanji.meaning) {
    // meaning이 문자열인 경우 객체로 변환
    if (typeof data.kanji.meaning === 'string') {
      entry.kanji = {
        ...data.kanji,
        meaning: {
          english: data.kanji.meaning,
          korean: koreanMeaning || ''
        }
      }
    } else {
      // meaning이 이미 객체인 경우 korean 필드 추가
      entry.kanji = {
        ...data.kanji,
        meaning: {
          ...data.kanji.meaning,
          korean: koreanMeaning || data.kanji.meaning.korean || ''
        }
      }
    }
  }
  
  // 선택적 필드들
  if (data.grade !== undefined) entry.grade = data.grade
  if (data.hint_group !== undefined) entry.hint_group = data.hint_group
  if (data.onyomi !== undefined) entry.onyomi = data.onyomi
  if (data.onyomi_ja !== undefined) entry.onyomi_ja = data.onyomi_ja
  if (data.kunyomi !== undefined) entry.kunyomi = data.kunyomi
  if (data.kunyomi_ja !== undefined) entry.kunyomi_ja = data.kunyomi_ja
  if (data.kunyomi_ka_display !== undefined) entry.kunyomi_ka_display = data.kunyomi_ka_display
  if (data.meaning !== undefined) entry.meaning = data.meaning
  if (data.kstroke !== undefined) entry.kstroke = data.kstroke
  if (data.rad_stroke !== undefined) entry.rad_stroke = data.rad_stroke
  if (data.rad_utf !== undefined) entry.rad_utf = data.rad_utf
  if (data.rad_name !== undefined) entry.rad_name = data.rad_name
  if (data.rad_name_ja !== undefined) entry.rad_name_ja = data.rad_name_ja
  if (data.rad_name_file !== undefined) entry.rad_name_file = data.rad_name_file
  if (data.rad_order !== undefined) entry.rad_order = data.rad_order
  if (data.rad_position !== undefined) entry.rad_position = data.rad_position
  if (data.rad_position_ja !== undefined) entry.rad_position_ja = data.rad_position_ja
  if (data.examples !== undefined) entry.examples = data.examples
  if (data.stroketimes !== undefined) entry.stroketimes = data.stroketimes
  if (data.ka_id !== undefined) entry.ka_id = data.ka_id
  if (data.kname !== undefined) entry.kname = data.kname
  if (data.dick !== undefined) entry.dick = data.dick
  if (data.dicn !== undefined) entry.dicn = data.dicn
  if (data.mn_hint !== undefined) entry.mn_hint = data.mn_hint
  
  return entry
}

const sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms))

async function main() {
  const CONCURRENT_LIMIT = 5 // 동시 처리 개수
  const BURST_SIZE = 1 // 한 청크(=30개) 처리 후 바로 쿨다운
  const BURST_COOLDOWN_MIN = 15000 // 최소 쿨다운 (밀리초)
  const BURST_COOLDOWN_MAX = 3000 // 최대 쿨다운 (밀리초)
  
  console.log(`총 ${N1_KANJI_LIST.length}개 한자 처리 시작...`)
  console.log(`병렬 처리: ${CONCURRENT_LIMIT}개씩 동시 실행`)
  console.log(`버스트: ${BURST_SIZE}청크 처리 후 ${BURST_COOLDOWN_MIN/1000}-${BURST_COOLDOWN_MAX/1000}초 랜덤 대기\n`)
  
  const kanjiDataArray: KanjiAliveEntry[] = []
  let successCount = 0
  let failCount = 0
  
  // 한자 리스트를 청크로 나누기
  const chunks: string[][] = []
  for (let i = 0; i < N1_KANJI_LIST.length; i += CONCURRENT_LIMIT) {
    chunks.push(N1_KANJI_LIST.slice(i, i + CONCURRENT_LIMIT))
  }
  
  // 각 청크를 병렬 처리
  for (let chunkIndex = 0; chunkIndex < chunks.length; chunkIndex++) {
    const chunk = chunks[chunkIndex]
    const startIndex = chunkIndex * CONCURRENT_LIMIT
    
    console.log(`[청크 ${chunkIndex + 1}/${chunks.length}] ${chunk.length}개 한자 병렬 처리 시작...`)
    
    // 청크 내 모든 한자를 병렬로 처리
    const results = await Promise.allSettled(
      chunk.map(async (kanji, index) => {
        const globalIndex = startIndex + index + 1
        const koreanMeaning = N1_KOREAN_MEANINGS[kanji] || ''
        
        console.log(`  [${globalIndex}/${N1_KANJI_LIST.length}] ${kanji} 처리 중... (한글 뜻: ${koreanMeaning})`)
        
        const apiData = await fetchKanjiData(kanji)
        
        if (!apiData) {
          console.log(`  ✗ ${kanji}: 데이터를 가져오지 못했습니다`)
          return null
        }
        
        // 인터페이스에 정의된 필드만 추출하고 한글 뜻 추가
        const filteredData = filterKanjiAliveEntry(apiData, koreanMeaning)
        console.log(`  ✓ ${kanji}: 완료`)
        return filteredData
      })
    )
    
    // 결과 처리
    for (const result of results) {
      if (result.status === 'fulfilled' && result.value !== null) {
        kanjiDataArray.push(result.value)
        successCount++
      } else {
        failCount++
      }
    }
    
    // 마지막 청크가 아니면 딜레이
    if (chunkIndex < chunks.length - 1) {
      // BURST_SIZE(예: 1) 청크마다 긴 랜덤 딜레이
      if ((chunkIndex + 1) % BURST_SIZE === 0) {
        const cooldown = Math.floor(Math.random() * (BURST_COOLDOWN_MAX - BURST_COOLDOWN_MIN + 1)) + BURST_COOLDOWN_MIN
        console.log(`  ⏳ 버스트 쿨다운: ${(cooldown / 1000).toFixed(1)}초 대기\n`)
        await sleep(cooldown)
      }
    }
  }
  
  // 파일 생성
  const outputFilePath = path.join(__dirname, '../data/kanji/n1.ts')
  
  const fileContent = `import { KanjiAliveEntry } from '../types'

// N1 한자 데이터 (${kanjiDataArray.length}개)
export const n1Kanji: KanjiAliveEntry[] = ${JSON.stringify(kanjiDataArray, null, 2)}
`
  
  fs.writeFileSync(outputFilePath, fileContent, 'utf-8')
  
  console.log(`\n✅ 파일 생성 완료!`)
  console.log(`   성공: ${successCount}개`)
  console.log(`   실패: ${failCount}개`)
  console.log(`   총: ${kanjiDataArray.length}개`)
  console.log(`\n생성된 파일: ${outputFilePath}`)
}

main().catch(console.error)
